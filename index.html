<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CA ANG/A1 Personnel Hub</title>
    <!-- Core Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains+Mono', monospace; }
        
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .print-container { box-shadow: none !important; border: 1px solid #e2e8f0 !important; }
            .bg-gradient-to-br { background: #f8fafc !important; color: #1e3a8a !important; border: 2px solid #1e3a8a !important; }
            .text-blue-200, .text-blue-300 { color: #475569 !important; }
            #final-pension { color: #1e3a8a !important; font-size: 3rem !important; }
            .section-card { border: 1px solid #e2e8f0 !important; margin-bottom: 1rem !important; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .excluded-period { opacity: 0.4; filter: grayscale(1); pointer-events: none; }
        .pro-rated-badge { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        /* Hub UI Effects */
        .calc-card:hover .card-icon { transform: scale(1.1); color: #2563eb; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        
        <!-- CA ANG/A1 Hub Header -->
        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4 border-b-2 border-blue-900 pb-6">
            <div class="cursor-pointer" onclick="showView('home')">
                <h1 class="text-3xl font-extrabold text-blue-900 flex items-center gap-2">
                    <i data-lucide="shield-check" class="w-10 h-10 text-blue-600"></i>
                    CA ANG/A1 Personnel Hub
                </h1>
                <p class="text-slate-500 text-sm font-bold uppercase tracking-widest mt-1">Force Support Directorate • California Air National Guard</p>
            </div>
            <div id="home-nav" class="hidden no-print">
                <button onclick="showView('home')" class="flex items-center gap-2 px-6 py-3 bg-blue-900 text-white rounded-2xl font-bold text-sm hover:bg-blue-800 shadow-lg transition-all">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                    Switch Calculator
                </button>
            </div>
        </header>

        <!-- VIEW: DASHBOARD -->
        <div id="view-home" class="animate-in fade-in slide-in-from-bottom-4 duration-500 py-10">
            <div class="mb-12 text-center md:text-left">
                <h2 class="text-xl font-black text-slate-800 mb-2 tracking-tight uppercase">Operational Resource Selection</h2>
                <p class="text-slate-500 text-sm font-medium">Select a module to access specialized personnel computation engines.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Select Original TAFMS Planner -->
                <div onclick="showView('planner')" class="calc-card group bg-white p-8 rounded-[40px] border border-slate-200 shadow-sm hover:shadow-2xl hover:border-blue-400 transition-all cursor-pointer relative overflow-hidden">
                    <div class="card-icon w-16 h-16 bg-blue-50 rounded-[24px] flex items-center justify-center text-blue-600 mb-6 transition-transform duration-300 shadow-inner">
                        <i data-lucide="calculator" class="w-10 h-10"></i>
                    </div>
                    <h3 class="text-xl font-black text-slate-800 mb-2 uppercase tracking-tight">TAFMS Planner</h3>
                    <p class="text-slate-500 text-xs leading-relaxed mb-8 font-medium">Accrual engine with PCARS scanner and High-3 forecasting.</p>
                    <div class="flex items-center text-blue-600 font-bold text-[10px] uppercase tracking-widest gap-2">
                        Open Planner <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>

                <!-- Select Auditor -->
                <div onclick="showView('auditor')" class="calc-card group bg-white p-8 rounded-[40px] border border-slate-200 shadow-sm hover:shadow-2xl hover:border-indigo-400 transition-all cursor-pointer relative overflow-hidden">
                    <div class="card-icon w-16 h-16 bg-indigo-50 rounded-[24px] flex items-center justify-center text-indigo-600 mb-6 transition-transform duration-300 shadow-inner">
                        <i data-lucide="history" class="w-10 h-10"></i>
                    </div>
                    <h3 class="text-xl font-black text-slate-800 mb-2 uppercase tracking-tight">TAFMSD Auditor</h3>
                    <p class="text-slate-500 text-xs leading-relaxed mb-8 font-medium">Establishes official start dates using backward logic ($Ref - Time + 1$).</p>
                    <div class="flex items-center text-indigo-600 font-bold text-[10px] uppercase tracking-widest gap-2">
                        Open Auditor <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>

                <!-- NEW: Durations Auditor -->
                <div onclick="showView('durations')" class="calc-card group bg-white p-8 rounded-[40px] border border-slate-200 shadow-sm hover:shadow-2xl hover:border-emerald-400 transition-all cursor-pointer relative overflow-hidden">
                    <div class="card-icon w-16 h-16 bg-emerald-50 rounded-[24px] flex items-center justify-center text-emerald-600 mb-6 transition-transform duration-300 shadow-inner">
                        <i data-lucide="award" class="w-10 h-10"></i>
                    </div>
                    <h3 class="text-xl font-black text-slate-800 mb-2 uppercase tracking-tight">TIG/TIS Auditor</h3>
                    <p class="text-slate-500 text-xs leading-relaxed mb-8 font-medium">Compute exact Time-In-Grade and Time-In-Service durations for promotion audits.</p>
                    <div class="flex items-center text-emerald-600 font-bold text-[10px] uppercase tracking-widest gap-2">
                        Open Auditor <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: TAFMS PLANNER (ORIGINAL CODE RESTORED) -->
        <div id="view-planner" class="hidden animate-in fade-in duration-300">
            <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-extrabold text-blue-900 flex items-center gap-2">
                        <i data-lucide="calculator" class="w-8 h-8 text-blue-600"></i>
                        ANG TAFMS & Retirement Planner
                    </h1>
                    <div class="flex items-center gap-2 mt-1 no-print">
                        <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider">Military Personnel Arithmetic</span>
                        <p class="text-slate-500 text-sm">30-Day Month logic with Year conversion (Total Days ÷ 360)</p>
                    </div>
                </div>
                <div id="tafms-badge" class="bg-blue-600 text-white px-6 py-3 rounded-2xl shadow-lg flex items-center gap-4">
                    <div class="text-right">
                        <p class="text-xs opacity-80 uppercase font-bold tracking-wider">Total TAFMS</p>
                        <p id="total-tafms-display" class="text-xl md:text-2xl font-mono whitespace-nowrap">0.00 Yrs (0 Days)</p>
                    </div>
                    <i data-lucide="clock" class="w-8 h-8 opacity-50"></i>
                </div>
            </header>

            <div class="mb-8 no-print">
                <div class="bg-blue-900 text-white p-6 rounded-3xl shadow-md flex flex-col md:flex-row items-center justify-between gap-4 border-b-4 border-blue-700">
                    <div class="flex items-center gap-4">
                        <div class="bg-blue-800 p-3 rounded-2xl"><i data-lucide="filter" class="w-6 h-6 text-blue-300"></i></div>
                        <div>
                            <h3 class="font-bold text-lg leading-tight tracking-tight">Calculation Cutoff Date</h3>
                            <p class="text-blue-300 text-xs">Determine points/TAFMS accrued prior to a specific date. Spanning rows will be pro-rated.</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="date" id="cutoff-date" class="bg-blue-800 border border-blue-700 text-white px-4 py-2 rounded-xl outline-none focus:ring-2 focus:ring-blue-400 font-bold" oninput="calculate()">
                        <button onclick="document.getElementById('cutoff-date').value = ''; calculate();" class="text-xs font-bold uppercase opacity-60 hover:opacity-100 transition-opacity">Clear</button>
                    </div>
                </div>
            </div>

            <div class="mb-8 no-print">
                <div class="bg-white border border-slate-200 rounded-3xl p-6 shadow-sm">
                    <h3 class="text-lg font-bold text-slate-800 mb-2 flex items-center gap-2">
                        <i data-lucide="zap" class="w-5 h-5 text-yellow-500"></i> Quick Import from PCARS
                    </h3>
                    <p class="text-slate-500 text-sm mb-4">Paste text from your <strong>Point Credit Summary</strong>. The tool detects "AD" points automatically and filters out inactive "Z" status lines.</p>
                    <textarea id="pcars-input" placeholder="Paste PCARS text here..." class="w-full h-24 p-4 text-sm bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none resize-none mb-3"></textarea>
                    <div class="flex justify-between items-center">
                        <button onclick="parseText()" class="bg-blue-600 text-white px-8 py-2.5 rounded-xl font-bold text-sm hover:bg-blue-700 transition-all flex items-center gap-2">
                            <i data-lucide="search" class="w-4 h-4"></i> Scan Text
                        </button>
                        <div id="parse-status" class="text-xs font-bold text-blue-500 hidden items-center gap-1">
                            <i data-lucide="check" class="w-3 h-3"></i> <span id="parse-status-text">Scanned successfully</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <section class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 section-card">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-2">
                                <h2 class="text-lg font-bold text-blue-900">Active Duty Periods (TAFMS)</h2>
                                <div class="group relative no-print">
                                    <i data-lucide="info" class="w-4 h-4 text-slate-300 cursor-help"></i>
                                    <div class="absolute bottom-full left-0 mb-2 w-64 p-3 bg-slate-800 text-white text-[10px] rounded-lg hidden group-hover:block z-50 shadow-xl">
                                        Calculated using 30-day month rule. +1 day added to make dates inclusive.
                                    </div>
                                </div>
                            </div>
                            <button onclick="addPeriod()" class="no-print bg-blue-50 text-blue-600 hover:bg-blue-100 px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-1 transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i> Add
                            </button>
                        </div>
                        <div id="periods-container" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar"></div>
                    </section>

                    <section class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 section-card">
                        <h2 class="text-lg font-bold flex items-center gap-2 mb-6 text-purple-900">
                            <i data-lucide="award" class="w-5 h-5 text-purple-500 no-print"></i>
                            Career Longevity & Points
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Total Career Longevity (Years)</label>
                                    <input type="number" id="career-years" value="20" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-purple-500 outline-none transition-all font-bold" oninput="calculate()">
                                    <p class="text-[10px] text-slate-400 mt-1 uppercase italic">Total years of service (PEBD to Projected Retirement)</p>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Avg Drill Points / Year (Reserve Time)</label>
                                    <input type="number" id="drill-points" value="48" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-purple-500 outline-none transition-all font-bold" oninput="calculate()">
                                    <p class="text-[10px] text-slate-400 mt-1 uppercase italic">Only applied to non-Active Duty years</p>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-2xl flex flex-col justify-center border border-slate-100 shadow-inner">
                                <div class="flex justify-between items-center mb-2"><span class="text-slate-500 text-sm">Membership Points</span><span class="font-bold text-slate-700">15 / yr</span></div>
                                <div class="flex justify-between items-center mb-2"><span class="text-slate-500 text-sm">Est. Reserve Years</span><span id="reserve-years-display" class="font-bold text-purple-700">0.00 Yrs</span></div>
                                <div class="flex justify-between items-center mb-4 pb-4 border-b border-slate-200"><span class="text-slate-500 text-sm">Correspondence/Misc</span><input type="number" id="other-points" value="0" class="w-20 bg-transparent text-right font-black text-slate-700 outline-none font-mono" oninput="calculate()"></div>
                                <div class="flex justify-between items-center"><span class="font-bold text-blue-900 uppercase text-xs tracking-widest">Final Projected Points</span><span id="total-points-display" class="text-2xl font-mono font-bold text-blue-600">0</span></div>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-3xl shadow-sm border-2 border-blue-100 no-print">
                        <h3 class="text-sm font-bold text-blue-900 uppercase tracking-widest mb-6 flex items-center gap-2"><i data-lucide="dollar-sign" class="w-4 h-4"></i> 2026 Pay Estimates</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 tracking-tight">Estimated Final Rank</label>
                                <select id="rank-select" class="w-full bg-slate-50 border border-slate-200 px-4 py-3 rounded-xl text-sm font-bold outline-none cursor-pointer" onchange="calculate()">
                                    <optgroup label="Enlisted">
                                        <option value="E-4">E-4 Senior Airman</option>
                                        <option value="E-5">E-5 Staff Sergeant</option>
                                        <option value="E-6" selected>E-6 Tech Sergeant</option>
                                        <option value="E-7">E-7 Master Sergeant</option>
                                        <option value="E-8">E-8 Senior Master Sgt</option>
                                        <option value="E-9">E-9 Chief Master Sgt</option>
                                    </optgroup>
                                    <optgroup label="Officer">
                                        <option value="O-1">O-1 Second Lieutenant</option>
                                        <option value="O-2">O-2 First Lieutenant</option>
                                        <option value="O-3">O-3 Captain</option>
                                        <option value="O-4">O-4 Major</option>
                                        <option value="O-5">O-5 Lieutenant Colonel</option>
                                        <option value="O-6">O-6 Colonel</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 tracking-tight">Pay Date Longevity</label>
                                <select id="longevity-select" class="w-full bg-slate-50 border border-slate-200 px-4 py-3 rounded-xl text-sm font-bold outline-none cursor-pointer" onchange="calculate()">
                                    <option value="<2">Less than 2</option>
                                    <option value="2">2 Years</option>
                                    <option value="3">3 Years</option>
                                    <option value="4">4 Years</option>
                                    <option value="6">6 Years</option>
                                    <option value="8">8 Years</option>
                                    <option value="10">10 Years</option>
                                    <option value="12">12 Years</option>
                                    <option value="14">14 Years</option>
                                    <option value="16">16 Years</option>
                                    <option value="18">18 Years</option>
                                    <option value="20" selected>Over 20 Years</option>
                                    <option value="22">Over 22 Years</option>
                                    <option value="24">Over 24 Years</option>
                                    <option value="26">Over 26 Years</option>
                                    <option value="30">Over 30 Years</option>
                                </select>
                            </div>
                            <div class="pt-4 border-t border-slate-100 flex justify-between items-center"><span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">Est. Basic Pay</span><span id="basic-pay-display" class="text-xl font-mono font-bold text-slate-800">$0.00</span></div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-blue-900 to-indigo-900 text-white p-8 rounded-[40px] shadow-xl relative overflow-hidden section-card">
                        <i data-lucide="trending-up" class="absolute -right-4 -bottom-4 w-32 h-32 opacity-10 no-print"></i>
                        <h3 class="text-xl font-bold mb-6 flex items-center gap-2 tracking-tight">Retirement Forecast</h3>
                        <div class="space-y-4 mb-8">
                            <div class="flex justify-between items-center text-sm"><span class="text-blue-200 font-bold uppercase text-[9px] tracking-widest">Multiplier (Legacy)</span><span class="font-mono font-bold">2.5% High-3</span></div>
                            <div class="flex justify-between items-center text-sm"><span class="text-blue-200 font-bold uppercase text-[9px] tracking-widest">1405 Date Credit</span><span id="credit-1405" class="font-mono font-bold text-yellow-400">0.0 Months</span></div>
                            <div class="flex justify-between items-center text-sm border-t border-blue-800 pt-3"><span class="text-blue-200 font-bold uppercase text-[9px] tracking-widest">Point Yrs Eq.</span><span id="point-years" class="font-mono font-bold text-lg">0.00</span></div>
                        </div>
                        <div class="text-center">
                            <p class="text-[10px] text-blue-300 uppercase font-black tracking-widest mb-1">Estimated Monthly Pension</p>
                            <span id="final-pension" class="text-5xl font-black text-white">$0.00</span>
                        </div>
                    </div>

                    <button onclick="window.print()" class="w-full bg-white text-blue-900 border border-blue-200 py-4 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-blue-50 transition-all no-print shadow-sm">
                        <i data-lucide="printer" class="w-5 h-5"></i> Save / Print Summary
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: TAFMSD AUDITOR (BACKWARD LOGIC) -->
        <div id="view-auditor" class="hidden animate-in fade-in duration-300">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                <div class="lg:col-span-5 space-y-6">
                    <div class="bg-white rounded-[40px] shadow-sm border border-slate-200 p-10 space-y-8">
                        <div>
                            <h2 class="text-xl font-black text-indigo-900 uppercase tracking-tight mb-6 flex items-center gap-2">
                                <i data-lucide="history" class="w-6 h-6 text-indigo-500"></i> Audit Parameters
                            </h2>
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Reference Date</label>
                            <input type="date" id="auditor-ref-date" class="w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-3xl font-black text-2xl outline-none focus:border-indigo-600 transition-all shadow-inner" value="" oninput="calculateAuditor()">
                        </div>
                        <div class="pt-8 border-t border-slate-100 text-center">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6 block uppercase tracking-tighter">Time to Deduct (360-Base)</label>
                            <div class="grid grid-cols-3 gap-4">
                                <div><span class="text-[9px] font-bold text-slate-400 uppercase mb-2 block">Yrs</span><input type="number" id="auditor-y" value="" placeholder="Yrs" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-center text-xl outline-none focus:border-indigo-600 shadow-sm" oninput="calculateAuditor()"></div>
                                <div><span class="text-[9px] font-bold text-slate-400 uppercase mb-2 block">Mos</span><input type="number" id="auditor-m" value="" placeholder="Mos" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-center text-xl outline-none focus:border-indigo-600 shadow-sm" oninput="calculateAuditor()"></div>
                                <div><span class="text-[9px] font-bold text-slate-400 uppercase mb-2 block">Days</span><input type="number" id="auditor-d" value="" placeholder="Days" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-center text-xl outline-none focus:border-indigo-600 shadow-sm" oninput="calculateAuditor()"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 bg-white rounded-[48px] shadow-2xl border-t-[12px] border-indigo-900 p-16 text-center">
                    <h3 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.5em] mb-12">Projected TAFMSD</h3>
                    <div class="py-16 bg-slate-50 rounded-[60px] border-2 border-slate-100 mb-12 shadow-inner group">
                        <span id="auditor-display" class="text-6xl md:text-8xl font-black tracking-tighter text-indigo-900 tabular-nums">-- --- ----</span>
                    </div>
                    <div class="grid grid-cols-2 gap-8 text-left">
                        <div class="p-6 bg-slate-50 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Personnel Record</span>
                            <span id="auditor-mil-days" class="text-2xl font-mono font-black text-slate-700">0</span>
                            <p class="text-[8px] font-bold text-slate-400 mt-1 uppercase tracking-tighter">Total System Days</p>
                        </div>
                        <div class="p-6 bg-slate-50 rounded-3xl border border-slate-200 shadow-sm">
                            <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Retirement Pts</span>
                            <span id="auditor-points" class="text-2xl font-mono font-black text-slate-700">0</span>
                            <p class="text-[8px] font-bold text-slate-400 mt-1 uppercase tracking-tighter">Actual Points Eq.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: TIG/TIS AUDITOR -->
        <div id="view-durations" class="hidden animate-in fade-in duration-300">
            <div class="mb-10">
                <h2 class="text-xl font-black text-slate-800 mb-1 tracking-tight uppercase">Promotion Audit Engine</h2>
                <p class="text-slate-500 text-sm font-medium">TIG/TIS Duration Auditor • DAFMAN 36-2604 Standards</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8 items-start">
                <div class="w-full lg:w-[400px] bg-white rounded-[40px] shadow-sm border border-slate-200 p-8 space-y-6">
                    <div class="flex items-center gap-2 mb-2">
                        <i data-lucide="history" class="w-5 h-5 text-emerald-600"></i>
                        <h3 class="text-lg font-black text-blue-900 uppercase tracking-tight">Audit Data</h3>
                    </div>

                    <div class="mb-6">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Effective Date of Rank</label>
                        <div class="relative group">
                            <i data-lucide="award" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                            <input type="date" id="dur-dor" class="w-full pl-12 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 focus:bg-white transition-all shadow-inner" oninput="calculateDurations()">
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Service Start Date (TAFMSD)</label>
                        <div class="relative group">
                            <i data-lucide="calendar" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                            <input type="date" id="dur-tis" class="w-full pl-12 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 focus:bg-white transition-all shadow-inner" oninput="calculateDurations()">
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Calculation Target</label>
                        <div class="relative group">
                            <i data-lucide="clock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                            <input type="date" id="dur-target" class="w-full pl-12 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 focus:bg-white transition-all shadow-inner" oninput="calculateDurations()">
                        </div>
                    </div>

                    <div class="pt-6 border-t border-slate-100">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Breaks in service</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dur-has-breaks" class="sr-only peer" onchange="toggleDurBreaks()">
                                <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                        <div id="dur-breaks-input" class="hidden">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Days to Deduct</label>
                            <input type="number" id="dur-break-days" value="0" class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 shadow-inner" oninput="calculateDurations()">
                        </div>
                    </div>
                </div>

                <div class="flex-1 space-y-6 w-full">
                    <div id="durations-idle" class="bg-white rounded-[48px] border border-slate-200 border-dashed p-20 flex flex-col items-center justify-center text-slate-300">
                        <div class="w-24 h-24 bg-slate-50 rounded-[32px] flex items-center justify-center mb-6"><i data-lucide="calculator" class="w-12 h-12 text-slate-200"></i></div>
                        <h3 class="text-xl font-black text-slate-400 uppercase tracking-widest">Engine Idle</h3>
                        <p class="text-sm font-bold text-slate-400 mt-2">Enter dates to generate report</p>
                    </div>

                    <div id="durations-results" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
                        <!-- TIG Card -->
                        <div class="bg-white p-6 md:p-10 rounded-[48px] border-t-[12px] border-blue-900 shadow-sm relative overflow-hidden">
                            <div class="flex items-center gap-4 mb-8">
                                <div class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 shadow-inner"><i data-lucide="award" class="w-6 h-6"></i></div>
                                <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight">Time In Grade <span class="text-blue-600 italic uppercase">Audit</span></h3>
                            </div>
                            
                            <div class="space-y-8">
                                <!-- Top: Main Duration -->
                                <div class="flex flex-wrap items-baseline gap-2 md:gap-4 text-5xl md:text-7xl font-black tracking-tighter text-blue-900 font-mono tabular-nums leading-tight">
                                    <div><span id="dur-tig-y">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal">Yrs</span></div>
                                    <div><span id="dur-tig-m">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal">Mos</span></div>
                                    <div><span id="dur-tig-d">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal">Days</span></div>
                                </div>
                                
                                <!-- Bottom: Totals -->
                                <div class="flex gap-4 border-t border-slate-100 pt-6">
                                    <div class="bg-slate-50 px-5 py-3 rounded-2xl border border-slate-100 min-w-[90px]">
                                        <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Total Mo.</span>
                                        <span id="dur-tig-mo-tot" class="text-xl font-black text-slate-800 font-mono">0</span>
                                    </div>
                                    <div class="bg-slate-50 px-5 py-3 rounded-2xl border border-slate-100 min-w-[90px]">
                                        <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Total Days</span>
                                        <span id="dur-tig-d-tot" class="text-xl font-black text-slate-800 font-mono">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- TIS Card -->
                        <div class="bg-white p-6 md:p-10 rounded-[48px] border-t-[12px] border-emerald-900 shadow-sm relative overflow-hidden">
                            <div class="flex items-center gap-4 mb-8">
                                <div class="w-12 h-12 bg-emerald-50 rounded-2xl flex items-center justify-center text-emerald-600 shadow-inner"><i data-lucide="clock" class="w-6 h-6"></i></div>
                                <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight">Time In Service <span class="text-emerald-600 italic uppercase">Audit</span></h3>
                            </div>

                            <div class="space-y-8">
                                <!-- Top: Main Duration -->
                                <div class="flex flex-wrap items-baseline gap-2 md:gap-4 text-5xl md:text-7xl font-black tracking-tighter text-emerald-900 font-mono tabular-nums leading-tight">
                                    <div><span id="dur-tis-y">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal">Yrs</span></div>
                                    <div><span id="dur-tis-m">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal">Mos</span></div>
                                    <div><span id="dur-tis-d">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal">Days</span></div>
                                </div>
                                
                                <!-- Bottom: Totals -->
                                <div class="flex gap-4 border-t border-slate-100 pt-6">
                                    <div class="bg-slate-50 px-5 py-3 rounded-2xl border border-slate-100 min-w-[90px]">
                                        <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Total Mo.</span>
                                        <span id="dur-tis-mo-tot" class="text-xl font-black text-slate-800 font-mono">0</span>
                                    </div>
                                    <div class="bg-slate-50 px-5 py-3 rounded-2xl border border-slate-100 min-w-[90px]">
                                        <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Total Days</span>
                                        <span id="dur-tis-d-tot" class="text-xl font-black text-slate-800 font-mono">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-amber-50 border border-amber-200 rounded-[32px] p-8 shadow-inner">
                            <h4 class="text-amber-900 font-black text-xs uppercase mb-4 flex items-center gap-2 tracking-tighter">
                                <i data-lucide="alert-triangle" class="w-4 h-4"></i> Computation Logic Disclosure
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-[11px] text-amber-800 font-medium leading-relaxed tracking-tight">
                                <ul class="space-y-1 list-disc pl-4">
                                    <li><strong>Military Factor:</strong> 30.44 day month normalization.</li>
                                    <li><strong>Year Basis:</strong> Standard 365.25 day leap-year compensation.</li>
                                </ul>
                                <ul class="space-y-1 list-disc pl-4">
                                    <li><strong>Verification:</strong> This tool is for estimation only.</li>
                                    <li><strong>Official Record:</strong> Refer to MilPDS for promotion eligibility.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-20 text-center text-slate-400 text-[10px] pb-12 no-print border-t-2 border-slate-200 pt-12 uppercase tracking-[0.5em] font-black">
            <p>© 2026 CA ANG/A1 • Force Support Directorate</p>
            <p class="mt-2 text-slate-300">California Air National Guard</p>
        </footer>
    </div>

    <script>
        // --- DATA ---
        const PAY_CHART = {
            "E-4": { "<2": 3142, "2": 3303, "3": 3482, "4": 3659, "6": 3815, "8": 3815, "10": 3815, "12": 3815, "14": 3815, "16": 3815, "18": 3815, "20": 3815, "22": 3815, "24": 3815, "26": 3815, "30": 3815 },
            "E-5": { "<2": 3343, "2": 3598, "3": 3776, "4": 3947, "6": 4110, "8": 4300, "10": 4510, "12": 4510, "14": 4510, "16": 4510, "18": 4510, "20": 4510, "22": 4510, "24": 4510, "26": 4510, "30": 4510 },
            "E-6": { "<2": 3401, "2": 3743, "3": 3908, "4": 4068, "6": 4236, "8": 4613, "10": 4759, "12": 5043, "14": 5130, "16": 5194, "18": 5268, "20": 5268, "22": 5268, "24": 5268, "26": 5268, "30": 5268 },
            "E-7": { "<2": 3932, "2": 4291, "3": 4456, "4": 4673, "6": 4844, "8": 5136, "10": 5300, "12": 5591, "14": 5834, "16": 6001, "18": 6177, "20": 6246, "22": 6475, "24": 6598, "26": 7067, "30": 7067 },
            "E-8": { "8": 6811, "10": 5907, "12": 6061, "14": 6247, "16": 6448, "18": 6811, "20": 6995, "22": 7308, "24": 7482, "26": 7909, "30": 8067 },
            "E-9": { "10": 6910, "12": 7067, "14": 7264, "16": 7496, "18": 7731, "20": 8105, "22": 8423, "24": 8756, "26": 9268, "30": 9731 },
            "O-1": { "<2": 4150, "2": 4320, "3": 5222, "4": 5222, "6": 5222, "30": 5222 },
            "O-2": { "<2": 4781, "2": 5421, "3": 6272, "30": 6272 },
            "O-3": { "<2": 5535, "2": 6273, "3": 6771, "4": 7383, "6": 7737, "8": 8125, "10": 8376, "12": 8788, "14": 9004, "16": 9004, "18": 9004, "20": 9004, "30": 9004 },
            "O-4": { "<2": 6294, "2": 7286, "3": 7773, "4": 7881, "6": 8332, "8": 8816, "10": 9419, "12": 9887, "14": 10214, "16": 10401, "18": 10509, "20": 10509, "30": 10509 },
            "O-5": { "<2": 7295, "2": 8219, "3": 8787, "4": 8894, "6": 9250, "8": 9461, "10": 9928, "12": 10272, "14": 10715, "16": 11391, "18": 11714, "20": 12033, "22": 12395, "30": 12395 },
            "O-6": { "<2": 8751, "2": 9614, "3": 10245, "4": 10245, "6": 10284, "8": 10725, "10": 10783, "12": 10783, "14": 11396, "16": 12480, "18": 13116, "20": 13751, "22": 14113, "24": 14479, "26": 15189, "30": 15189 }
        };

        let periods = [{ id: Date.now(), desc: 'Initial Entry', start: '', end: '', manualDays: '' }];

        function showView(viewName) {
            ['home', 'planner', 'auditor', 'durations'].forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            document.getElementById('home-nav').classList.toggle('hidden', viewName === 'home');
            lucide.createIcons();
            if (viewName === 'planner') calculate();
            if (viewName === 'auditor') calculateAuditor();
            if (viewName === 'durations') calculateDurations();
            window.scrollTo(0, 0);
        }

        function isLeap(year) { return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0); }

        // --- PLANNER ENGINE (ORIGINAL) ---
        function calculateMilitaryDays(startStr, endStr) {
            if (!startStr || !endStr) return 0;
            const s = new Date(startStr + 'T00:00:00');
            const e = new Date(endStr + 'T00:00:00');
            let y1 = s.getFullYear(), m1 = s.getMonth() + 1, d1 = s.getDate();
            let y2 = e.getFullYear(), m2 = e.getMonth() + 1, d2 = e.getDate();
            if (m1 === 2 && d1 >= 28) {
                if (!isLeap(y1) || (isLeap(y1) && d1 === 29)) d1 = 30;
                else if (isLeap(y1) && d1 === 28) d1 = 30;
            }
            if (m2 === 2 && d2 >= 28) {
                if (!isLeap(y2) || (isLeap(y2) && d2 === 29)) d2 = 30;
                else if (isLeap(y2) && d2 === 28) d2 = 30;
            }
            if (d1 === 31) d1 = 30; if (d2 === 31) d2 = 30;
            const diff = ((y2 - y1) * 360) + ((m2 - m1) * 30) + (d2 - d1) + 1;
            return diff > 0 ? diff : 0;
        }

        function getActualCalendarDays(startStr, endStr) {
            if (!startStr || !endStr) return 0;
            const s = new Date(startStr + 'T00:00:00');
            const e = new Date(endStr + 'T00:00:00');
            return Math.ceil((e - s) / (1000 * 60 * 60 * 24)) + 1;
        }

        function calculate() {
            let totalAdDays = 0;
            const cutoffStr = document.getElementById('cutoff-date').value;
            const cutoffDate = cutoffStr ? new Date(cutoffStr + 'T00:00:00') : null;
            periods.forEach(p => {
                const rowEl = document.getElementById(`period-${p.id}`);
                const badgeEl = document.getElementById(`row-badge-${p.id}`);
                const periodStart = p.start ? new Date(p.start + 'T00:00:00') : null;
                const periodEnd = p.end ? new Date(p.end + 'T00:00:00') : null;
                let isExcluded = false; let isProRated = false; let effectiveEndStr = p.end;
                if (cutoffDate && periodStart) {
                    if (periodStart > cutoffDate) isExcluded = true;
                    else if (periodEnd && periodEnd > cutoffDate) { isProRated = true; effectiveEndStr = cutoffStr; }
                }
                if (rowEl) {
                    isExcluded ? rowEl.classList.add('excluded-period') : rowEl.classList.remove('excluded-period');
                    if (badgeEl) isProRated ? badgeEl.classList.remove('hidden') : badgeEl.classList.add('hidden');
                }
                if (!isExcluded) {
                    const fullActual = getActualCalendarDays(p.start, p.end);
                    const effectiveActual = getActualCalendarDays(p.start, effectiveEndStr);
                    let daysToUse = 0;
                    if (p.manualDays !== '' && p.manualDays !== null) {
                        const manualPoints = parseInt(p.manualDays);
                        daysToUse = (isProRated && fullActual > 0) ? Math.round(manualPoints * (effectiveActual / fullActual)) : manualPoints;
                    } else {
                        daysToUse = calculateMilitaryDays(p.start, effectiveEndStr);
                    }
                    totalAdDays += (isNaN(daysToUse) ? 0 : daysToUse);
                }
            });
            const tafmsYearsRaw = totalAdDays / 360;
            document.getElementById('total-tafms-display').innerText = `${tafmsYearsRaw.toFixed(2)} Yrs (${totalAdDays} Days)`;
            const totalCareerYears = parseFloat(document.getElementById('career-years').value) || 0;
            const drillPoints = parseInt(document.getElementById('drill-points').value) || 0;
            const otherPoints = parseInt(document.getElementById('other-points').value) || 0;
            let reserveYears = Math.max(0, totalCareerYears - tafmsYearsRaw);
            document.getElementById('reserve-years-display').innerText = `${reserveYears.toFixed(2)} Yrs`;
            const reservePoints = reserveYears * (15 + drillPoints);
            const totalPoints = Math.round(totalAdDays + reservePoints + otherPoints);
            document.getElementById('total-points-display').innerText = totalPoints.toLocaleString();
            const rank = document.getElementById('rank-select').value;
            const longevity = document.getElementById('longevity-select').value;
            const basicPay = PAY_CHART[rank] ? (PAY_CHART[rank][longevity] || 0) : 0;
            document.getElementById('basic-pay-display').innerText = `$${basicPay.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            const pointYearsEquivalent = totalPoints / 360;
            document.getElementById('point-years').innerText = pointYearsEquivalent.toFixed(2);
            const monthlyPension = pointYearsEquivalent * 0.025 * basicPay;
            document.getElementById('final-pension').innerText = `$${monthlyPension.toLocaleString(undefined, {maximumFractionDigits: 2})}`;
            document.getElementById('credit-1405').innerText = `${(totalPoints / 30).toFixed(1)} Months`;
        }

        // --- AUDITOR ENGINE ---
        function calculateAuditor() {
            const refStr = document.getElementById('auditor-ref-date').value;
            if (!refStr) {
                document.getElementById('auditor-display').innerText = "-- --- ----";
                document.getElementById('auditor-mil-days').innerText = "0";
                document.getElementById('auditor-points').innerText = "0";
                return;
            }
            const y = parseInt(document.getElementById('auditor-y').value) || 0;
            const m = parseInt(document.getElementById('auditor-m').value) || 0;
            const d = parseInt(document.getElementById('auditor-d').value) || 0;
            const ref = new Date(refStr + 'T00:00:00');
            let ry = ref.getFullYear() - y;
            let rm = (ref.getMonth() + 1) - m;
            let rd = ref.getDate();
            if (rm === 2 && rd >= 28) {
                if (!isLeap(ry) || (isLeap(ry) && rd === 29)) rd = 30;
                else if (isLeap(ry) && rd === 28) rd = 30;
            }
            rd = (rd - d) + 1; 
            while (rd < 1) { rd += 30; rm -= 1; }
            while (rm < 1) { rm += 12; ry -= 1; }
            if (rm === 2 && rd >= 30) { rm = 3; rd = 1; }
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            document.getElementById('auditor-display').innerText = `${String(rd).padStart(2, '0')} ${months[rm - 1]} ${ry}`;
            const milDays = (y * 360) + (m * 30) + d;
            document.getElementById('auditor-mil-days').innerText = milDays.toLocaleString();
            document.getElementById('auditor-points').innerText = Math.round((y * 365.25) + (m * 30.44) + d).toLocaleString();
        }

        // --- DURATIONS ENGINE (TIG/TIS) ---
        function toggleDurBreaks() {
            document.getElementById('dur-breaks-input').classList.toggle('hidden', !document.getElementById('dur-has-breaks').checked);
            calculateDurations();
        }

        function calculateDurations() {
            const dor = document.getElementById('dur-dor').value;
            const tis = document.getElementById('dur-tis').value;
            const target = document.getElementById('dur-target').value;
            const hasBreaks = document.getElementById('dur-has-breaks').checked;
            const breakDays = parseInt(document.getElementById('dur-break-days').value) || 0;

            if (!dor && !tis) {
                document.getElementById('durations-idle').classList.remove('hidden');
                document.getElementById('durations-results').classList.add('hidden');
                return;
            }

            document.getElementById('durations-idle').classList.add('hidden');
            document.getElementById('durations-results').classList.remove('hidden');

            const tDate = target ? new Date(target + 'T00:00:00') : new Date();

            const getDiff = (startStr, end, adjustmentDays = 0) => {
                if (!startStr) return null;
                const start = new Date(startStr + 'T00:00:00');
                let diffMs = end.getTime() - start.getTime();
                if (adjustmentDays > 0) diffMs -= (adjustmentDays * 24 * 60 * 60 * 1000);
                if (diffMs < 0) return { y: 0, m: 0, d: 0, mo: 0, day: 0 };
                const totalDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                const years = Math.floor(diffMs / (1000 * 60 * 60 * 24 * 365.25));
                const remainingAfterYears = diffMs % (1000 * 60 * 60 * 24 * 365.25);
                const months = Math.floor(remainingAfterYears / (1000 * 60 * 60 * 24 * 30.44));
                const remainingAfterMonths = remainingAfterYears % (1000 * 60 * 60 * 24 * 30.44);
                const days = Math.floor(remainingAfterMonths / (1000 * 60 * 60 * 24));
                return { y: years, m: months, d: days, mo: (years * 12) + months, day: totalDays };
            };

            const tig = getDiff(dor, tDate);
            const tisRes = getDiff(tis, tDate, hasBreaks ? breakDays : 0);

            if (tig) {
                document.getElementById('dur-tig-y').innerText = tig.y;
                document.getElementById('dur-tig-m').innerText = tig.m;
                document.getElementById('dur-tig-d').innerText = tig.d;
                document.getElementById('dur-tig-mo-tot').innerText = tig.mo;
                document.getElementById('dur-tig-d-tot').innerText = tig.day.toLocaleString();
            }
            if (tisRes) {
                document.getElementById('dur-tis-y').innerText = tisRes.y;
                document.getElementById('dur-tis-m').innerText = tisRes.m;
                document.getElementById('dur-tis-d').innerText = tisRes.d;
                document.getElementById('dur-tis-mo-tot').innerText = tisRes.mo;
                document.getElementById('dur-tis-d-tot').innerText = tisRes.day.toLocaleString();
            }
        }

        // --- PCARS SCANNER ---
        function parseText() {
            const text = document.getElementById('pcars-input').value;
            const statusEl = document.getElementById('parse-status'); const statusText = document.getElementById('parse-status-text');
            if (!text) return;
            const dateRegex = /(\d{1,2}[-\s][A-Z]{3}[-\s]\d{4})|(\d{4}[\/-]\d{2}[\/-]\d{2})/gi;
            const monthMap = { JAN: '01', FEB: '02', MAR: '03', APR: '04', MAY: '05', JUN: '06', JUL: '07', AUG: '08', SEP: '09', OCT: '10', NOV: '11', DEC: '12' };
            const normalizeDate = (dStr) => {
                const cleanStr = dStr.trim().replace(/[-\/]/g, ' '); const parts = cleanStr.split(/\s+/);
                if (parts.length === 3) {
                    if (parts[1].length === 3 && monthMap[parts[1].toUpperCase()]) return `${parts[2]}-${monthMap[parts[1].toUpperCase()]}-${parts[0].padStart(2, '0')}`;
                    if (parts[0].length === 4) return `${parts[0]}-${parts[1].padStart(2, '0')}-${parts[2].padStart(2, '0')}`;
                }
                return null;
            };
            const lines = text.split('\n'); const foundPeriods = []; let totalFound = 0, skippedZ = 0;
            lines.forEach(line => {
                const matches = line.match(dateRegex);
                if (matches && matches.length === 2) {
                    const startDate = normalizeDate(matches[0]);
                    const endDate = normalizeDate(matches[1]);
                    if (startDate && endDate) {
                        const remainingText = line.replace(matches[0], '').replace(matches[1], '').trim();
                        const tokens = remainingText.split(/\s+/);
                        if (tokens.some(t => t.toUpperCase().startsWith('Z'))) skippedZ++;
                        else {
                            const pts = parseInt(tokens[0]);
                            if (pts > 0) {
                                foundPeriods.push({ id: Date.now() + Math.random(), desc: `Imported Period`, start: startDate, end: endDate, manualDays: pts });
                                totalFound++;
                            }
                        }
                    }
                }
            });
            if (totalFound > 0) {
                document.getElementById('periods-container').innerHTML = '';
                periods = foundPeriods; periods.forEach(p => addPeriod(p));
                statusEl.classList.remove('hidden', 'text-red-500'); statusEl.classList.add('text-blue-500');
                statusText.innerText = `Imported ${totalFound} periods (${skippedZ} lines skipped)`;
            } else {
                statusEl.classList.remove('hidden', 'text-blue-500'); statusEl.classList.add('text-red-500');
                statusText.innerText = "No AD points found";
            }
            setTimeout(() => statusEl.classList.add('hidden'), 4000); calculate();
        }

        // --- SHARED UI UTILS ---
        function addPeriod(data = null) {
            const period = data || { id: Date.now(), desc: '', start: '', end: '', manualDays: '' };
            if (!data) periods.push(period);
            const container = document.getElementById('periods-container');
            const div = document.createElement('div');
            div.id = `period-${period.id}`;
            div.className = "grid grid-cols-1 md:grid-cols-12 gap-3 p-4 bg-slate-50 rounded-2xl border border-slate-100 items-end relative period-row mb-4 shadow-sm";
            div.innerHTML = `
                <div class="md:col-span-4"><label class="text-[10px] font-bold text-slate-400 uppercase tracking-tight">Description</label><input type="text" value="${period.desc}" oninput="updatePeriod(${period.id}, 'desc', this.value)" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 font-bold"></div>
                <div class="md:col-span-3"><label class="text-[10px] font-bold text-slate-400 uppercase tracking-tight">Start Date</label><input type="date" value="${period.start}" oninput="updatePeriod(${period.id}, 'start', this.value)" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 font-bold"></div>
                <div class="md:col-span-3"><label class="text-[10px] font-bold text-slate-400 uppercase tracking-tight">End Date</label><input type="date" value="${period.end}" oninput="updatePeriod(${period.id}, 'end', this.value)" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 font-bold"></div>
                <div class="md:col-span-2 flex items-center justify-end gap-3 no-print">
                    <div class="text-center mr-2"><label class="text-[9px] text-slate-400 font-bold uppercase block tracking-tighter">AD Days</label><input type="number" id="manual-days-${period.id}" value="${period.manualDays}" placeholder="${calculateMilitaryDays(period.start, period.end)}" oninput="updatePeriod(${period.id}, 'manualDays', this.value)" class="w-16 bg-white border border-slate-200 text-center text-xs font-bold text-blue-600 rounded-md py-1 shadow-sm"></div>
                    <button onclick="removePeriod(${period.id})" class="p-2 text-slate-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>
                <div id="row-badge-${period.id}" class="absolute -top-2 -left-2 hidden"><span class="pro-rated-badge bg-blue-600 text-white text-[8px] font-black px-2 py-0.5 rounded-full shadow-sm uppercase tracking-tighter">Cutoff Applied</span></div>
            `;
            container.appendChild(div);
            lucide.createIcons(); calculate();
        }

        function removePeriod(id) { if (periods.length > 1) { periods = periods.filter(p => p.id !== id); document.getElementById(`period-${id}`).remove(); calculate(); } }
        function updatePeriod(id, field, value) { const p = periods.find(p => p.id === id); if (p) p[field] = value; calculate(); }

        window.onload = () => {
            addPeriod(periods[0]); 
            document.getElementById('dur-target').value = new Date().toISOString().split('T')[0];
            lucide.createIcons(); 
            showView('home');
        };
    </script>
</body>
</html>
