<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CA ANG/A1 Personnel Hub</title>
    <!-- Core Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc;
            /* Faded Background Imagery - Fixed and Centered */
            background-image: linear-gradient(rgba(248, 250, 252, 0.88), rgba(248, 250, 252, 0.88)), url('image_d5cdbb.png');
            background-attachment: fixed;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .font-mono { font-family: 'JetBrains+Mono', monospace; }
        
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; background-image: none !important; }
            .print-container { box-shadow: none !important; border: 1px solid #e2e8f0 !important; }
            .bg-gradient-to-br { background: #f8fafc !important; color: #1e3a8a !important; border: 2px solid #1e3a8a !important; }
            .text-blue-200, .text-blue-300 { color: #475569 !important; }
            #final-pension { color: #1e3a8a !important; font-size: 3rem !important; }
            .section-card { border: 1px solid #e2e8f0 !important; margin-bottom: 1rem !important; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .excluded-period { opacity: 0.4; filter: grayscale(1); pointer-events: none; }
        .pro-rated-badge { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        /* Hub UI Effects */
        .calc-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .calc-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-4px);
        }
        .calc-card:hover .card-icon { transform: scale(1.1); color: #2563eb; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        input[type="date"] { min-width: 140px; }

        /* Branding Gold Accents */
        .ca-gold-text { color: #b8922e; }
        .ca-gold-bg { background-color: #b8922e; }
        .ca-blue-bg { background-color: #003087; }
    </style>
</head>
<body class="text-slate-900 min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        
        <!-- Hub Header -->
        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4 border-b-2 border-blue-900 pb-6 relative z-10">
            <div class="cursor-pointer flex items-center gap-4" onclick="showView('home')">
                <div class="p-2 ca-blue-bg rounded-xl shadow-lg">
                    <i data-lucide="shield-check" class="w-10 h-10 text-white"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold text-blue-900 flex items-center gap-2 tracking-tighter uppercase">
                        CA ANG/A1 Personnel Hub
                    </h1>
                    <p class="text-slate-500 text-xs font-black uppercase tracking-[0.2em] mt-1 tracking-widest">Force Support Directorate โข California Air National Guard</p>
                </div>
            </div>
            <div id="home-nav" class="hidden no-print">
                <button onclick="showView('home')" class="flex items-center gap-2 px-6 py-3 ca-blue-bg text-white rounded-2xl font-bold text-sm hover:bg-blue-800 shadow-lg transition-all active:scale-95">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                    Back to Selection
                </button>
            </div>
        </header>

        <!-- VIEW: DASHBOARD -->
        <div id="view-home" class="animate-in fade-in slide-in-from-bottom-4 duration-500 py-10 relative z-10">
            <div class="mb-12 text-center md:text-left flex flex-col md:flex-row md:items-end justify-between gap-4">
                <div>
                    <h2 class="text-xl font-black text-slate-800 mb-2 tracking-tight uppercase">Operational Computing Engines</h2>
                    <p class="text-slate-500 text-sm font-medium">Authoritative personnel computation resources for the California Air National Guard.</p>
                </div>
                <div class="hidden md:block">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest px-4 py-2 bg-white/50 rounded-full border border-slate-200 backdrop-blur uppercase">System Ver: 27.5</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
                <!-- Planner -->
                <div onclick="showView('planner')" class="calc-card group p-6 rounded-[32px] shadow-sm hover:shadow-2xl transition-all cursor-pointer relative overflow-hidden flex flex-col border border-slate-200">
                    <div class="card-icon w-12 h-12 bg-blue-50 rounded-[16px] flex items-center justify-center text-blue-600 mb-4 transition-transform duration-300">
                        <i data-lucide="calculator" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-base font-black text-slate-800 mb-1 uppercase tracking-tight leading-none">TAFMS Planner</h3>
                    <p class="text-slate-500 text-[10px] leading-relaxed mb-6 font-medium flex-grow uppercase">Aggregate points and forecast pension.</p>
                    <div class="flex items-center text-blue-600 font-bold text-[9px] uppercase tracking-widest gap-2">
                        Open <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>

                <!-- Auditor -->
                <div onclick="showView('auditor')" class="calc-card group p-6 rounded-[32px] shadow-sm hover:shadow-2xl transition-all cursor-pointer relative overflow-hidden flex flex-col border border-slate-200">
                    <div class="card-icon w-12 h-12 bg-indigo-50 rounded-[16px] flex items-center justify-center text-indigo-600 mb-4 transition-transform duration-300">
                        <i data-lucide="history" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-base font-black text-slate-800 mb-1 uppercase tracking-tight leading-none">TAFMSD Auditor</h3>
                    <p class="text-slate-500 text-[10px] leading-relaxed mb-6 font-medium flex-grow uppercase">Compute start dates via backward logic.</p>
                    <div class="flex items-center text-indigo-600 font-bold text-[9px] uppercase tracking-widest gap-2">
                        Open <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>

                <!-- Service Dates -->
                <div onclick="showView('durations')" class="calc-card group p-6 rounded-[32px] shadow-sm hover:shadow-2xl transition-all cursor-pointer relative overflow-hidden flex flex-col border border-slate-200">
                    <div class="card-icon w-12 h-12 bg-emerald-50 rounded-[16px] flex items-center justify-center text-emerald-600 mb-4 transition-transform duration-300">
                        <i data-lucide="calendar" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-base font-black text-slate-800 mb-1 uppercase tracking-tight leading-none">Service Dates</h3>
                    <p class="text-slate-500 text-[10px] leading-relaxed mb-6 font-medium flex-grow uppercase">Compute TIG and TIS durations.</p>
                    <div class="flex items-center text-emerald-600 font-bold text-[9px] uppercase tracking-widest gap-2">
                        Open <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>

                <!-- 1825 -->
                <div onclick="showView('1825')" class="calc-card group p-6 rounded-[32px] shadow-sm hover:shadow-2xl transition-all cursor-pointer relative overflow-hidden flex flex-col border border-slate-200">
                    <div class="card-icon w-12 h-12 bg-amber-50 rounded-[16px] flex items-center justify-center text-amber-600 mb-4 transition-transform duration-300">
                        <i data-lucide="shield" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-base font-black text-slate-800 mb-1 uppercase tracking-tight leading-none">1825 Rule</h3>
                    <p class="text-slate-500 text-[10px] leading-relaxed mb-6 font-medium flex-grow uppercase">Track rolling window AD caps.</p>
                    <div class="flex items-center text-amber-600 font-bold text-[9px] uppercase tracking-widest gap-2">
                        Open <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>

                <!-- SCOD -->
                <div onclick="showView('scod')" class="calc-card group p-6 rounded-[40px] shadow-sm hover:shadow-2xl transition-all cursor-pointer relative overflow-hidden flex flex-col border border-slate-200">
                    <div class="card-icon w-14 h-14 bg-rose-50 rounded-[20px] flex items-center justify-center text-rose-600 mb-4 transition-transform duration-300">
                        <i data-lucide="file-text" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-lg font-black text-slate-800 mb-2 uppercase tracking-tight leading-tight uppercase tracking-widest">SCOD Engine</h3>
                    <p class="text-slate-500 text-[10px] leading-relaxed mb-6 font-medium flex-grow uppercase">Track eval closeout deadlines.</p>
                    <div class="flex items-center text-rose-600 font-bold text-[10px] uppercase tracking-widest gap-2">
                        Open <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-2 transition-transform"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: TAFMS PLANNER -->
        <div id="view-planner" class="hidden animate-in fade-in duration-300 relative z-10">
            <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-extrabold text-blue-900 flex items-center gap-2 uppercase tracking-widest leading-none">
                        ANG TAFMS & Retirement Planner
                    </h1>
                    <div class="flex items-center gap-2 mt-1 no-print">
                        <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider uppercase tracking-widest uppercase">Military Personnel Arithmetic</span>
                        <p class="text-slate-500 text-sm">30-Day Month logic with Year conversion (Total Days รท 360)</p>
                    </div>
                </div>
                <div id="tafms-badge" class="bg-blue-600 text-white px-6 py-3 rounded-2xl shadow-lg flex items-center gap-4">
                    <div class="text-right">
                        <p class="text-xs opacity-80 uppercase font-bold tracking-wider">Total TAFMS</p>
                        <p id="total-tafms-display" class="text-xl md:text-2xl font-mono whitespace-nowrap uppercase">0.00 Yrs (0 Days)</p>
                    </div>
                    <i data-lucide="clock" class="w-8 h-8 opacity-50"></i>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-blue-900 text-white p-6 rounded-3xl shadow-md flex flex-col md:flex-row items-center justify-between gap-4 border-b-4 border-blue-700 no-print">
                        <div class="flex items-center gap-4">
                            <div class="bg-blue-800 p-3 rounded-2xl"><i data-lucide="filter" class="w-6 h-6 text-blue-300"></i></div>
                            <div>
                                <h3 class="font-bold text-lg leading-tight uppercase tracking-widest uppercase">Calculation Cutoff</h3>
                                <p class="text-blue-300 text-xs font-medium uppercase">Spanning rows will be pro-rated.</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="date" id="cutoff-date" class="bg-blue-800 border border-blue-700 text-white px-4 py-2 rounded-xl outline-none focus:ring-2 focus:ring-blue-400 font-bold" oninput="calculate()">
                            <button onclick="document.getElementById('cutoff-date').value = ''; calculate();" class="text-xs font-bold uppercase opacity-60 hover:opacity-100 transition-opacity">Clear</button>
                        </div>
                    </div>

                    <section class="bg-white/90 backdrop-blur p-6 rounded-3xl shadow-sm border border-slate-200 section-card">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-bold text-blue-900 uppercase tracking-widest uppercase">Active Duty Periods (TAFMS)</h2>
                            <button onclick="addPeriod()" class="no-print bg-blue-50 text-blue-600 hover:bg-blue-100 px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-1 transition-colors uppercase tracking-widest uppercase"><i data-lucide="plus" class="w-4 h-4"></i> Add Period</button>
                        </div>
                        <div id="periods-container" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar"></div>
                    </section>

                    <section class="bg-white/90 backdrop-blur p-6 rounded-3xl shadow-sm border border-slate-200 section-card">
                        <h2 class="text-lg font-bold flex items-center gap-2 mb-6 text-purple-900 uppercase tracking-widest uppercase"><i data-lucide="award" class="w-5 h-5 text-purple-500 no-print"></i> Career Projection</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1 tracking-widest uppercase uppercase">Total Career Years</label>
                                    <input type="number" id="career-years" value="20" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-purple-500 outline-none transition-all font-bold" oninput="calculate()">
                                    <p class="text-[10px] text-slate-400 mt-1 uppercase italic font-bold uppercase">PEBD to Projected Retirement</p>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1 tracking-widest uppercase uppercase">Avg Drill Pts / Yr</label>
                                    <input type="number" id="drill-points" value="48" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-purple-500 outline-none transition-all font-bold" oninput="calculate()">
                                    <p class="text-[10px] text-slate-400 mt-1 uppercase italic font-bold uppercase">Non-Active Duty years only</p>
                                </div>
                            </div>
                            <div class="bg-slate-50/80 p-6 rounded-3xl flex flex-col justify-center border border-slate-100 shadow-inner text-sm font-black uppercase tracking-tight">
                                <div class="flex justify-between items-center mb-3"><span class="text-slate-500 text-[10px] tracking-widest">Membership</span><span class="font-bold text-slate-700">15 / yr</span></div>
                                <div class="flex justify-between items-center mb-3"><span class="text-slate-500 text-[10px] tracking-widest">Reserve Time</span><span id="reserve-years-display" class="font-bold text-purple-700">0.00 Yrs</span></div>
                                <div class="flex justify-between items-center mb-4 pb-4 border-b border-slate-200"><span class="text-slate-500 text-[10px] tracking-widest">Correspondence</span><input type="number" id="other-points" value="0" class="w-20 bg-transparent text-right font-black text-slate-700 outline-none font-mono" oninput="calculate()"></div>
                                <div class="flex justify-between items-center"><span class="font-bold text-blue-900 text-xs tracking-widest">Final Points</span><span id="total-points-display" class="text-2xl font-mono font-bold text-blue-600">0</span></div>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="space-y-6">
                    <div class="bg-white/90 backdrop-blur p-6 rounded-3xl shadow-sm border-2 border-blue-100 no-print">
                        <h3 class="text-sm font-bold text-blue-900 uppercase tracking-widest mb-6 flex items-center gap-2 uppercase tracking-widest uppercase"><i data-lucide="dollar-sign" class="w-4 h-4"></i> Pay Estimates</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 tracking-tight tracking-widest uppercase uppercase">Estimated Final Rank</label>
                                <select id="rank-select" class="w-full bg-slate-50 border border-slate-200 px-4 py-3 rounded-xl text-sm font-bold outline-none cursor-pointer" onchange="calculate()">
                                    <optgroup label="Enlisted">
                                        <option value="E-4">E-4 Senior Airman</option>
                                        <option value="E-5">E-5 Staff Sergeant</option>
                                        <option value="E-6" selected>E-6 Tech Sergeant</option>
                                        <option value="E-7">E-7 Master Sergeant</option>
                                        <option value="E-8">E-8 Senior Master Sgt</option>
                                        <option value="E-9">E-9 Chief Master Sgt</option>
                                    </optgroup>
                                    <optgroup label="Officer">
                                        <option value="O-1">O-1 Second Lieutenant</option>
                                        <option value="O-2">O-2 First Lieutenant</option>
                                        <option value="O-3">O-3 Captain</option>
                                        <option value="O-4">O-4 Major</option>
                                        <option value="O-5">O-5 Lieutenant Colonel</option>
                                        <option value="O-6">O-6 Colonel</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1 tracking-tight tracking-widest uppercase uppercase">Pay Longevity</label>
                                <select id="longevity-select" class="w-full bg-slate-50 border border-slate-200 px-4 py-3 rounded-xl text-sm font-bold outline-none cursor-pointer" onchange="calculate()">
                                    <option value="18">18 Years</option>
                                    <option value="20" selected>Over 20 Years</option>
                                    <option value="22">Over 22 Years</option>
                                </select>
                            </div>
                            <div class="pt-4 border-t border-slate-100 flex justify-between items-center"><span class="text-xs font-bold text-slate-400 uppercase tracking-tighter tracking-widest uppercase uppercase">Est. Basic Pay</span><span id="basic-pay-display" class="text-xl font-mono font-bold text-slate-800">$0.00</span></div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-blue-900 to-indigo-900 text-white p-8 rounded-[40px] shadow-xl relative overflow-hidden section-card">
                        <i data-lucide="trending-up" class="absolute -right-4 -bottom-4 w-32 h-32 opacity-10 no-print"></i>
                        <h3 class="text-xl font-bold mb-6 flex items-center gap-2 uppercase tracking-widest uppercase">Retirement Forecast</h3>
                        <div class="space-y-4 mb-8 text-sm uppercase font-black uppercase">
                            <div class="flex justify-between items-center"><span class="text-blue-200 text-[10px] tracking-widest uppercase">Multiplier</span><span class="font-mono font-bold uppercase">2.5% High-3</span></div>
                            <div class="flex justify-between items-center"><span class="text-blue-200 text-[10px] tracking-widest uppercase">1405 Credit</span><span id="credit-1405" class="font-mono font-bold text-yellow-400 uppercase">0.0 Months</span></div>
                            <div class="flex justify-between items-center border-t border-blue-800 pt-3 uppercase"><span class="text-blue-200 text-[10px] tracking-widest uppercase">Point Yrs Eq.</span><span id="point-years" class="font-mono font-bold text-lg uppercase">0.00</span></div>
                        </div>
                        <div class="text-center">
                            <p class="text-[9px] text-blue-300 uppercase font-black tracking-widest mb-1 uppercase uppercase">Est. Monthly Pension</p>
                            <span id="final-pension" class="text-5xl font-black text-white uppercase">$0.00</span>
                        </div>
                    </div>

                    <button onclick="window.print()" class="w-full bg-white text-blue-900 border border-blue-200 py-4 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-blue-50 transition-all no-print shadow-sm uppercase tracking-widest leading-none uppercase">
                        <i data-lucide="printer" class="w-5 h-5"></i> Save Summary
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: TAFMSD AUDITOR -->
        <div id="view-auditor" class="hidden animate-in fade-in duration-300 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                <div class="lg:col-span-5 space-y-6">
                    <div class="bg-white/90 backdrop-blur rounded-[40px] shadow-sm border border-slate-200 p-10 space-y-8">
                        <div>
                            <h2 class="text-xl font-black text-indigo-900 uppercase tracking-tight mb-6 flex items-center gap-2 uppercase tracking-widest uppercase">
                                <i data-lucide="history" class="w-6 h-6 text-indigo-500"></i> Parameters
                            </h2>
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase">Reference Date</label>
                            <input type="date" id="auditor-ref-date" class="w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-3xl font-black text-2xl outline-none focus:border-indigo-600 transition-all shadow-inner uppercase" value="" oninput="calculateAuditor()">
                        </div>
                        <div class="pt-8 border-t border-slate-100 text-center uppercase uppercase">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6 block uppercase tracking-tighter tracking-widest uppercase uppercase">Time to Deduct (360-Base)</label>
                            <div class="grid grid-cols-3 gap-4">
                                <div><span class="text-[9px] font-bold text-slate-400 uppercase mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase tracking-widest uppercase">Yrs</span><input type="number" id="auditor-y" value="" placeholder="Yrs" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-center text-xl outline-none focus:border-indigo-600 shadow-sm uppercase" oninput="calculateAuditor()"></div>
                                <div><span class="text-[9px] font-bold text-slate-400 uppercase mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase tracking-widest uppercase">Mos</span><input type="number" id="auditor-m" value="" placeholder="Mos" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-center text-xl outline-none focus:border-indigo-600 shadow-sm uppercase" oninput="calculateAuditor()"></div>
                                <div><span class="text-[9px] font-bold text-slate-400 uppercase mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase tracking-widest uppercase">Days</span><input type="number" id="auditor-d" value="" placeholder="Days" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-center text-xl outline-none focus:border-indigo-600 shadow-sm uppercase" oninput="calculateAuditor()"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 bg-white rounded-[48px] shadow-2xl border-t-[12px] border-indigo-900 p-16 text-center relative overflow-hidden">
                    <h3 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.5em] mb-12 tracking-widest uppercase tracking-widest uppercase uppercase tracking-widest uppercase uppercase">Projected TAFMSD</h3>
                    <div class="py-16 bg-slate-50 rounded-[60px] border-2 border-slate-100 mb-12 shadow-inner group uppercase uppercase">
                        <span id="auditor-display" class="text-6xl md:text-8xl font-black tracking-tighter text-indigo-900 tabular-nums uppercase uppercase">-- --- ----</span>
                    </div>
                    <div class="grid grid-cols-2 gap-8 text-left text-sm uppercase font-black uppercase tracking-widest uppercase">
                        <div class="p-6 bg-slate-50 rounded-3xl border border-slate-200 shadow-sm uppercase">
                            <span class="text-[9px] font-black text-slate-400 tracking-widest block mb-1 uppercase tracking-widest uppercase uppercase">Personnel Record</span>
                            <span id="auditor-mil-days" class="text-2xl font-mono font-black text-slate-700 uppercase">0</span>
                            <p class="text-[8px] font-bold text-slate-400 mt-1 uppercase tracking-tighter uppercase uppercase">Total System Days</p>
                        </div>
                        <div class="p-6 bg-slate-50 rounded-3xl border border-slate-200 shadow-sm uppercase">
                            <span class="text-[9px] font-black text-slate-400 tracking-widest block mb-1 uppercase tracking-widest uppercase uppercase">Retirement Pts</span>
                            <span id="auditor-points" class="text-2xl font-mono font-black text-slate-700 uppercase">0</span>
                            <p class="text-[8px] font-bold text-slate-400 mt-1 uppercase tracking-tighter uppercase uppercase">Actual Point Eq.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: SERVICE DATES ENGINE -->
        <div id="view-durations" class="hidden animate-in fade-in duration-300 relative z-10">
            <div class="mb-10 text-center md:text-left">
                <h2 class="text-xl font-black text-slate-800 mb-1 tracking-tight uppercase tracking-widest leading-none">Service Dates Engine</h2>
                <p class="text-slate-500 text-sm font-medium uppercase tracking-tighter tracking-widest uppercase uppercase">Duration Computation Engine</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8 items-start">
                <div class="w-full lg:w-[400px] bg-white/90 backdrop-blur rounded-[40px] shadow-sm border border-slate-200 p-8 space-y-6">
                    <div class="flex items-center gap-2 mb-2">
                        <i data-lucide="calendar" class="w-5 h-5 text-emerald-600"></i>
                        <h3 class="text-lg font-black text-blue-900 uppercase tracking-tight uppercase tracking-widest uppercase">Parameters</h3>
                    </div>

                    <div class="mb-6">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase">Calculation Type</label>
                        <select id="dur-type" class="w-full px-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 focus:bg-white appearance-none cursor-pointer shadow-inner uppercase tracking-widest uppercase" onchange="calculateDurations()">
                            <option value="Time In Grade">Time In Grade</option>
                            <option value="Time In Service">Time In Service</option>
                            <option value="Custom Duration">Custom Duration</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase">Start Date</label>
                        <input type="date" id="dur-start" class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 focus:bg-white transition-all shadow-inner uppercase tracking-widest uppercase" oninput="calculateDurations()">
                    </div>

                    <div class="mb-6">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase">Target Date</label>
                        <input type="date" id="dur-target" class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 focus:bg-white transition-all shadow-inner uppercase tracking-widest uppercase" oninput="calculateDurations()">
                    </div>

                    <div class="pt-6 border-t border-slate-100">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest uppercase">Lost Time Adjustments</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dur-has-breaks" class="sr-only peer" onchange="toggleDurBreaks()">
                                <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                            </label>
                        </div>
                        <div id="dur-breaks-input" class="hidden">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block uppercase tracking-widest uppercase">Days to Deduct</label>
                            <input type="number" id="dur-break-days" value="0" class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-emerald-600 shadow-inner uppercase tracking-widest uppercase" oninput="calculateDurations()">
                        </div>
                    </div>
                </div>

                <div class="flex-1 space-y-6 w-full">
                    <div id="durations-idle" class="bg-white/80 backdrop-blur rounded-[48px] border border-slate-200 border-dashed p-20 flex flex-col items-center justify-center text-slate-300 shadow-inner uppercase uppercase">
                        <h3 class="text-xl font-black text-slate-400 uppercase tracking-widest leading-none uppercase">Engine Idle</h3>
                        <p class="text-sm font-bold text-slate-400 mt-2 tracking-tight uppercase uppercase">Enter dates to compute durations</p>
                    </div>

                    <div id="durations-results" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
                        <div class="bg-white p-10 rounded-[48px] border-t-[12px] border-blue-900 shadow-sm relative overflow-hidden uppercase">
                            <div class="flex items-center gap-4 mb-8 uppercase">
                                <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight leading-none uppercase tracking-widest uppercase"><span id="dur-result-label">Duration</span></h3>
                            </div>
                            <div class="space-y-8 uppercase">
                                <div class="flex flex-wrap items-baseline gap-2 md:gap-4 text-5xl md:text-7xl font-black tracking-tighter text-blue-900 font-mono tabular-nums leading-tight uppercase">
                                    <div><span id="dur-res-y">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal uppercase tracking-widest uppercase uppercase">Yrs</span></div>
                                    <div><span id="dur-res-m">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal uppercase tracking-widest uppercase uppercase">Mos</span></div>
                                    <div><span id="dur-res-d">0</span><span class="text-base md:text-xl font-bold text-slate-300 ml-1 md:ml-2 uppercase italic tracking-normal uppercase tracking-widest uppercase uppercase">Days</span></div>
                                </div>
                                <div class="flex gap-4 border-t border-slate-100 pt-6 uppercase">
                                    <div class="bg-slate-50 px-5 py-3 rounded-2xl border border-slate-100 min-w-[90px] shadow-inner text-center uppercase">
                                        <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1 uppercase tracking-widest uppercase uppercase">Total Mo.</span>
                                        <span id="dur-res-mo-tot" class="text-xl font-black text-slate-800 font-mono uppercase">0</span>
                                    </div>
                                    <div class="bg-slate-50 px-5 py-3 rounded-2xl border border-slate-100 min-w-[90px] shadow-inner text-center uppercase">
                                        <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1 uppercase tracking-widest uppercase uppercase">Total Days</span>
                                        <span id="dur-res-d-tot" class="text-xl font-black text-slate-800 font-mono uppercase">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: 1825 RULE TRACKER -->
        <div id="view-1825" class="hidden animate-in fade-in duration-300 relative z-10">
            <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <h1 class="text-3xl font-extrabold text-blue-900 flex items-center gap-2 uppercase tracking-widest leading-none uppercase">
                    <i data-lucide="shield" class="w-8 h-8 text-amber-500"></i> 1825 Rule Tracker
                </h1>
                <div class="bg-amber-600 text-white px-8 py-4 rounded-[32px] shadow-xl flex items-center gap-6 w-full md:w-auto">
                    <div class="text-right uppercase">
                        <p class="text-[10px] opacity-70 uppercase font-black tracking-widest uppercase uppercase">Non-Exempt Count</p>
                        <p id="total-1825-display" class="text-2xl font-mono font-bold whitespace-nowrap uppercase">0 Days</p>
                    </div>
                    <i data-lucide="layers" class="w-8 h-8 opacity-40"></i>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <section class="bg-white/90 backdrop-blur p-6 rounded-3xl shadow-sm border border-slate-200 section-card">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-bold text-blue-900 uppercase tracking-widest uppercase uppercase">Active Duty Tours</h2>
                            <button onclick="addPeriod1825()" class="no-print bg-amber-50 text-amber-600 hover:bg-amber-100 px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-1 transition-colors uppercase tracking-widest uppercase"><i data-lucide="plus" class="w-4 h-4"></i> Add Tour</button>
                        </div>
                        <div id="periods-1825-container" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar"></div>
                    </section>
                </div>

                <div class="space-y-6">
                    <section class="bg-white/90 backdrop-blur p-8 rounded-[40px] border border-slate-200 shadow-sm">
                        <div class="space-y-6 uppercase">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest uppercase tracking-widest uppercase">Reference Date</label>
                                <input type="date" id="ref-date-1825" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl font-black text-lg outline-none focus:border-amber-500 transition-all shadow-inner uppercase tracking-widest uppercase" oninput="calculate1825()">
                            </div>
                            <div class="p-5 bg-amber-50 rounded-3xl border border-amber-100 uppercase font-black tracking-tight text-[11px] text-amber-700 uppercase">
                                Counts only <span class="text-blue-900 underline font-black uppercase">non-exempt</span> tours within the last <span class="font-black uppercase">1,825 days</span> (5 years).
                            </div>
                        </div>
                    </section>

                    <div class="bg-white/90 backdrop-blur p-8 rounded-[40px] shadow-xl border-t-[12px] border-amber-600">
                        <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest mb-8 uppercase tracking-widest uppercase">Cap Status</h3>
                        <div class="space-y-8 uppercase">
                            <div>
                                <div class="flex justify-between mb-2 uppercase font-black text-[10px] text-slate-400 tracking-widest uppercase">1,825 Day Cap<span id="prog-1825-text" class="uppercase">0%</span></div>
                                <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden"><div id="prog-1825" class="bg-amber-500 h-full transition-all" style="width: 0%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-2 uppercase font-black text-[10px] text-slate-400 tracking-widest uppercase">2,190 Day Cap<span id="prog-2190-text" class="uppercase">0%</span></div>
                                <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden"><div id="prog-2190" class="bg-red-600 h-full transition-all" style="width: 0%"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: SCOD CALCULATOR -->
        <div id="view-scod" class="hidden animate-in fade-in duration-300 relative z-10">
            <div class="mb-10 text-center md:text-left">
                <h2 class="text-xl font-black text-slate-800 mb-1 tracking-tight uppercase tracking-widest uppercase tracking-widest uppercase uppercase">SCOD Reference Engine</h2>
                <p class="text-slate-500 text-sm font-medium uppercase tracking-tighter uppercase tracking-widest uppercase uppercase">Air National Guard Evaluation Schedule</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                <!-- Parameters Panel -->
                <div class="lg:col-span-5 bg-white/90 backdrop-blur rounded-[40px] shadow-sm border border-slate-200 p-10 space-y-8">
                    <div>
                        <h2 class="text-xl font-black text-blue-900 uppercase tracking-tight mb-6 flex items-center gap-2 uppercase tracking-widest uppercase tracking-widest uppercase">
                            <i data-lucide="settings" class="w-6 h-6 text-blue-600"></i> Parameters
                        </h2>
                        
                        <div class="mb-6">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase">Member Rank</label>
                            <div class="relative group">
                                <i data-lucide="award" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                                <select id="scod-rank" class="w-full pl-12 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-blue-600 focus:bg-white appearance-none cursor-pointer shadow-inner uppercase tracking-widest uppercase tracking-widest uppercase" onchange="toggleManualSCOD()">
                                    <optgroup label="Officers (Total Force)">
                                        <option value="O1-O2">2d Lt / 1st Lt (31 Oct)</option>
                                        <option value="O3">Captain (31 Aug)</option>
                                        <option value="O4-O5">Major / Lt Col (31 May)</option>
                                        <option value="O6">Colonel (28 Feb)</option>
                                    </optgroup>
                                    <optgroup label="Enlisted (ANG)">
                                        <option value="E1-E4">SrA and below (31 Mar)</option>
                                        <option value="E5">Staff Sergeant (31 Jan)</option>
                                        <option value="E6">Technical Sergeant (30 Nov)</option>
                                        <option value="E7">Master Sergeant (30 Sep)</option>
                                        <option value="E8">Senior Master Sgt (31 Jul)</option>
                                        <option value="E9">Chief Master Sgt (31 May)</option>
                                    </optgroup>
                                    <optgroup label="Special Control">
                                        <option value="MANUAL">Manual / Custom Date Override</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>

                        <div id="scod-status-group" class="mb-6">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase">Duty Status</label>
                            <div class="relative group">
                                <i data-lucide="user-check" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                                <select id="scod-status" class="w-full pl-12 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-blue-600 focus:bg-white appearance-none cursor-pointer shadow-inner uppercase tracking-widest uppercase tracking-widest uppercase" onchange="calculateSCOD()">
                                    <option value="AGR">AGR / Statutory Tour (Annual)</option>
                                    <option value="DSG">DSG / Part-Time (Biennial)</option>
                                </select>
                            </div>
                        </div>

                        <div id="scod-year-group" class="mb-6">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase">Evaluation Year</label>
                            <div class="relative group uppercase">
                                <i data-lucide="calendar" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors uppercase"></i>
                                <input type="number" id="scod-year" class="w-full pl-12 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-blue-600 focus:bg-white shadow-inner uppercase tracking-widest uppercase tracking-widest uppercase" oninput="calculateSCOD()">
                            </div>
                        </div>

                        <div id="scod-manual-group" class="mb-6 hidden">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block tracking-widest uppercase uppercase tracking-widest uppercase">Custom Transitional Closeout</label>
                            <div class="relative group uppercase">
                                <i data-lucide="edit-3" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors uppercase"></i>
                                <input type="date" id="scod-manual-date" class="w-full pl-12 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-3xl font-bold text-lg outline-none focus:border-blue-600 focus:bg-white shadow-inner uppercase tracking-widest uppercase tracking-widest uppercase" oninput="calculateSCOD()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Display Panel -->
                <div class="lg:col-span-7 bg-white rounded-[48px] shadow-2xl border-t-[12px] border-blue-900 p-12 text-center relative overflow-hidden">
                    <div class="space-y-8">
                        <div class="bg-slate-50 rounded-[40px] p-8 border-2 border-slate-100 shadow-inner">
                            <h3 class="text-[9px] font-black text-slate-400 uppercase tracking-[0.4em] mb-4">Static Closeout (SCOD)</h3>
                            <span id="scod-display" class="text-5xl md:text-7xl font-black tracking-tighter text-blue-900 tabular-nums uppercase leading-none">-- --- ----</span>
                        </div>

                        <div class="bg-amber-50 rounded-[40px] p-8 border-2 border-amber-100 shadow-sm relative">
                            <h3 class="text-[9px] font-black text-amber-600 uppercase tracking-[0.4em] mb-4">Accounting Date</h3>
                            <span id="accounting-display" class="text-4xl md:text-5xl font-black tracking-tighter text-amber-900 tabular-nums uppercase leading-none">-- --- ----</span>
                            <p class="text-[8px] text-amber-600 mt-4 font-black uppercase tracking-widest">Unit responsibility determined as of this date per MilPDS status.</p>
                            <div id="biennial-badge" class="absolute -top-3 right-8 bg-blue-600 text-white text-[8px] font-black px-4 py-1 rounded-full uppercase hidden">Biennial Year</div>
                        </div>

                        <div id="scod-days-badge" class="inline-flex items-center gap-3 bg-blue-100 text-blue-700 px-8 py-4 rounded-full font-black text-sm uppercase tracking-widest shadow-sm">
                            <i data-lucide="clock" class="w-5 h-5"></i>
                            <span id="scod-countdown">Calculating...</span>
                        </div>
                        
                        <div id="scod-warning" class="bg-rose-50 text-rose-700 p-4 rounded-2xl text-[10px] font-bold uppercase hidden">
                            Rank parity error: SCODs for this rank occur on <span id="scod-parity-note"></span> years.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-20 text-center text-slate-400 text-[10px] pb-12 no-print border-t-2 border-slate-200 pt-12 uppercase tracking-[0.5em] font-black relative z-10">
            <p>ยฉ 2026 CA ANG/A1 โข Force Support Directorate</p>
            <p class="mt-2 ca-gold-text opacity-70 italic tracking-[0.1em] tracking-tighter tracking-widest uppercase uppercase tracking-widest uppercase tracking-widest uppercase tracking-widest uppercase tracking-widest uppercase">California Air National Guard</p>
        </footer>
    </div>

    <script>
        // --- SHARED DATA ---
        const PAY_CHART = {
            "E-4": { "18": 3815, "20": 3815, "22": 3815 },
            "E-5": { "18": 4510, "20": 4510, "22": 4510 },
            "E-6": { "18": 5268, "20": 5268, "22": 5268 },
            "E-7": { "18": 6177, "20": 6246, "22": 6475 },
            "E-8": { "18": 6811, "20": 6995, "22": 7308 },
            "E-9": { "18": 7731, "20": 8105, "22": 8423 },
            "O-1": { "18": 5222, "20": 5222, "22": 5222 },
            "O-2": { "18": 6272, "20": 6272, "22": 6272 },
            "O-3": { "18": 9004, "20": 9004, "22": 9004 },
            "O-4": { "18": 10509, "20": 10509, "22": 10509 },
            "O-5": { "18": 11714, "20": 12033, "22": 12395 },
            "O-6": { "18": 13116, "20": 13751, "22": 14113 }
        };

        const EXEMPT_TYPES = ['AGR', 'ADT', 'AT', 'School'];

        let periods = [{ id: Date.now(), desc: 'Initial Entry', start: '', end: '', manualDays: '' }];
        let periods1825 = [{ id: Date.now(), desc: 'Tour Alpha', start: '', end: '', type: 'ADOS-RC' }];

        function showView(viewName) {
            ['home', 'planner', 'auditor', 'durations', '1825', 'scod'].forEach(v => {
                const el = document.getElementById(`view-${v}`);
                if (el) el.classList.add('hidden');
            });
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            document.getElementById('home-nav').classList.toggle('hidden', viewName === 'home');
            lucide.createIcons();
            if (viewName === 'planner') calculate();
            if (viewName === 'auditor') calculateAuditor();
            if (viewName === 'durations') calculateDurations();
            if (viewName === '1825') calculate1825();
            if (viewName === 'scod') calculateSCOD();
            window.scrollTo(0, 0);
        }

        function isLeap(year) { return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0); }

        function getActualCalendarDays(startStr, endStr) {
            if (!startStr || !endStr) return 0;
            const s = new Date(startStr + 'T00:00:00');
            const e = new Date(endStr + 'T00:00:00');
            return Math.ceil((e - s) / (1000 * 60 * 60 * 24)) + 1;
        }

        function updateRowDayDisplays(containerId, mode) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const rows = container.querySelectorAll('.row-day-count');
            const dataSet = containerId === 'periods-container' ? periods : periods1825;
            rows.forEach((badge, idx) => {
                const p = dataSet[idx];
                if (!p) return;
                let dayCount = mode === 'mil' ? (p.manualDays !== '' ? parseInt(p.manualDays) : calculateMilitaryDays(p.start, p.end)) : getActualCalendarDays(p.start, p.end);
                badge.innerText = isNaN(dayCount) ? "0" : dayCount.toLocaleString();
            });
        }

        // --- PLANNER ENGINE ---
        function calculateMilitaryDays(startStr, endStr) {
            if (!startStr || !endStr) return 0;
            const s = new Date(startStr + 'T00:00:00'), e = new Date(endStr + 'T00:00:00');
            let y1 = s.getFullYear(), m1 = s.getMonth() + 1, d1 = s.getDate();
            let y2 = e.getFullYear(), m2 = e.getMonth() + 1, d2 = e.getDate();
            if (m1 === 2 && d1 >= 28) { if (!isLeap(y1) || (isLeap(y1) && d1 === 29)) d1 = 30; else if (isLeap(y1) && d1 === 28) d1 = 30; }
            if (m2 === 2 && d2 >= 28) { if (!isLeap(y2) || (isLeap(y2) && d2 === 29)) d2 = 30; else if (isLeap(y2) && d2 === 28) d2 = 30; }
            if (d1 === 31) d1 = 30; if (d2 === 31) d2 = 30;
            return ((y2 - y1) * 360) + ((m2 - m1) * 30) + (d2 - d1) + 1;
        }

        function calculate() {
            let totalAdDays = 0;
            const cutoffStr = document.getElementById('cutoff-date').value;
            const cutoffDate = cutoffStr ? new Date(cutoffStr + 'T00:00:00') : null;
            periods.forEach(p => {
                const periodStart = p.start ? new Date(p.start + 'T00:00:00') : null;
                const periodEnd = p.end ? new Date(p.end + 'T00:00:00') : null;
                let effectiveEndStr = p.end;
                let isExcluded = cutoffDate && periodStart && periodStart > cutoffDate;
                let isProRated = !isExcluded && cutoffDate && periodEnd && periodEnd > cutoffDate;
                if (isProRated) effectiveEndStr = cutoffStr;
                const rowEl = document.getElementById(`period-${p.id}`), badgeEl = document.getElementById(`row-badge-${p.id}`);
                if (rowEl) { isExcluded ? rowEl.classList.add('excluded-period') : rowEl.classList.remove('excluded-period'); if (badgeEl) isProRated ? badgeEl.classList.remove('hidden') : badgeEl.classList.add('hidden'); }
                if (!isExcluded) {
                    const fullActual = getActualCalendarDays(p.start, p.end), effectiveActual = getActualCalendarDays(p.start, effectiveEndStr);
                    let daysToUse = p.manualDays !== '' && p.manualDays !== null ? (isProRated && fullActual > 0 ? Math.round(parseInt(p.manualDays) * (effectiveActual / fullActual)) : parseInt(p.manualDays)) : calculateMilitaryDays(p.start, effectiveEndStr);
                    totalAdDays += (isNaN(daysToUse) ? 0 : daysToUse);
                }
            });
            const tafmsYears = totalAdDays / 360;
            document.getElementById('total-tafms-display').innerText = `${tafmsYears.toFixed(2)} Yrs (${totalAdDays} Days)`;
            const careerYears = parseFloat(document.getElementById('career-years').value) || 0;
            const drillPoints = parseInt(document.getElementById('drill-points').value) || 0;
            let resYears = Math.max(0, careerYears - tafmsYears);
            document.getElementById('reserve-years-display').innerText = `${resYears.toFixed(2)} Yrs`;
            const totPoints = Math.round(totalAdDays + (resYears * (15 + drillPoints)) + (parseInt(document.getElementById('other-points').value) || 0));
            document.getElementById('total-points-display').innerText = totPoints.toLocaleString();
            const rank = document.getElementById('rank-select').value;
            const basicPay = (PAY_CHART[rank] || {})[document.getElementById('longevity-select').value] || 0;
            document.getElementById('basic-pay-display').innerText = `$${basicPay.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('point-years').innerText = (totPoints / 360).toFixed(2);
            document.getElementById('final-pension').innerText = `$${((totPoints / 360) * 0.025 * basicPay).toLocaleString(undefined, {maximumFractionDigits: 2})}`;
            document.getElementById('credit-1405').innerText = `${(totPoints / 30).toFixed(1)} Months`;
            updateRowDayDisplays('periods-container', 'mil');
        }

        // --- AUDITOR ENGINE ---
        function calculateAuditor() {
            const refStr = document.getElementById('auditor-ref-date').value;
            if (!refStr) return;
            const y = parseInt(document.getElementById('auditor-y').value) || 0, m = parseInt(document.getElementById('auditor-m').value) || 0, d = parseInt(document.getElementById('auditor-d').value) || 0;
            const ref = new Date(refStr + 'T00:00:00');
            let ry = ref.getFullYear() - y, rm = (ref.getMonth() + 1) - m, rd = ref.getDate();
            if (rm === 2 && rd >= 28) { if (!isLeap(ry) || (isLeap(ry) && rd === 29)) rd = 30; else if (isLeap(ry) && rd === 28) rd = 30; }
            rd = (rd - d) + 1; while (rd < 1) { rd += 30; rm -= 1; } while (rm < 1) { rm += 12; ry -= 1; }
            if (rm === 2 && rd >= 30) { rm = 3; rd = 1; }
            const mos = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            document.getElementById('auditor-display').innerText = `${String(rd).padStart(2, '0')} ${mos[rm - 1]} ${ry}`;
            document.getElementById('auditor-mil-days').innerText = ((y * 360) + (m * 30) + d).toLocaleString();
            document.getElementById('auditor-points').innerText = Math.round((y * 365.25) + (m * 30.44) + d).toLocaleString();
        }

        // --- SERVICE DATES ENGINE ---
        function toggleDurBreaks() { document.getElementById('dur-breaks-input').classList.toggle('hidden', !document.getElementById('dur-has-breaks').checked); calculateDurations(); }
        function calculateDurations() {
            const startStr = document.getElementById('dur-start').value;
            if (!startStr) { document.getElementById('durations-idle').classList.remove('hidden'); document.getElementById('durations-results').classList.add('hidden'); return; }
            document.getElementById('durations-idle').classList.add('hidden'); document.getElementById('durations-results').classList.remove('hidden');
            document.getElementById('dur-result-label').innerText = document.getElementById('dur-type').value;
            const tDate = document.getElementById('dur-target').value ? new Date(document.getElementById('dur-target').value + 'T00:00:00') : new Date();
            let diffMs = tDate.getTime() - new Date(startStr + 'T00:00:00').getTime();
            if (document.getElementById('dur-has-breaks').checked) diffMs -= ((parseInt(document.getElementById('dur-break-days').value) || 0) * 86400000);
            const totalDays = Math.max(0, Math.floor(diffMs / 86400000));
            const y = Math.floor(totalDays / 365.25), m = Math.floor((totalDays % 365.25) / 30.44), d = Math.floor((totalDays % 365.25) % 30.44);
            document.getElementById('dur-res-y').innerText = y; document.getElementById('dur-res-m').innerText = m; document.getElementById('dur-res-d').innerText = d;
            document.getElementById('dur-res-mo-tot').innerText = (y * 12) + m; document.getElementById('dur-res-d-tot').innerText = totalDays.toLocaleString();
        }

        // --- 1825 RULE ENGINE ---
        function calculate1825() {
            const refStr = document.getElementById('ref-date-1825').value;
            if (!refStr) return;
            const refDate = new Date(refStr + 'T00:00:00'), winStart = new Date(refDate.getTime() - (1825 * 86400000));
            let counted = 0;
            periods1825.forEach(p => {
                if (!p.start || !p.end || EXEMPT_TYPES.includes(p.type)) return;
                const ps = new Date(p.start + 'T00:00:00'), pe = new Date(p.end + 'T00:00:00');
                const es = ps < winStart ? winStart : ps, ee = pe > refDate ? refDate : pe;
                if (es <= ee) counted += Math.ceil((ee - es) / 86400000) + 1;
            });
            document.getElementById('total-1825-display').innerText = `${counted.toLocaleString()} Days`;
            const p1 = Math.min(100, Math.round((counted / 1825) * 100)), p2 = Math.min(100, Math.round((counted / 2190) * 100));
            document.getElementById('prog-1825-text').innerText = `${p1}%`; document.getElementById('prog-1825').style.width = `${p1}%`;
            document.getElementById('prog-2190-text').innerText = `${p2}%`; document.getElementById('prog-2190').style.width = `${p2}%`;
            updateRowDayDisplays('periods-1825-container', 'calendar');
        }

        // --- SCOD ENGINE (ANG SPECIFIC) ---
        function toggleManualSCOD() {
            const rank = document.getElementById('scod-rank').value;
            const isManual = rank === 'MANUAL';
            const isOfficer = rank.startsWith('O');
            
            document.getElementById('scod-status-group').classList.toggle('hidden', isOfficer || isManual);
            document.getElementById('scod-year-group').classList.toggle('hidden', isManual);
            document.getElementById('scod-manual-group').classList.toggle('hidden', !isManual);
            calculateSCOD();
        }

        function calculateSCOD() {
            const rank = document.getElementById('scod-rank').value;
            const status = document.getElementById('scod-status').value;
            const warningEl = document.getElementById('scod-warning');
            const biennialEl = document.getElementById('biennial-badge');
            
            let scodDate;
            let accountingDate;

            if (rank === 'MANUAL') {
                const manualVal = document.getElementById('scod-manual-date').value;
                if (!manualVal) {
                    ['scod-display', 'accounting-display'].forEach(id => document.getElementById(id).innerText = "-- --- ----");
                    document.getElementById('scod-countdown').innerText = "Enter Custom Date";
                    return;
                }
                scodDate = new Date(manualVal + 'T23:59:59');
                accountingDate = new Date(scodDate.getTime() - (120 * 86400000));
                warningEl.classList.add('hidden');
                biennialEl.classList.add('hidden');
            } else {
                const year = parseInt(document.getElementById('scod-year').value) || new Date().getFullYear();
                
                // Rules based on provided ANG Schedule
                const scodConfig = {
                    'O1-O2': { m: 9, d: 31, am: 6, ad: 3 },  // 31 Oct / 3 July
                    'O3':    { m: 7, d: 31, am: 4, ad: 3 },  // 31 Aug / 3 May
                    'O4-O5': { m: 4, d: 31, am: 1, ad: 3 },  // 31 May / 3 Feb
                    'O6':    { m: 1, d: 28, am: 10, ad: 3 }, // 28 Feb / 3 Nov (Prev Year)
                    'E1-E4': { m: 2, d: 31, parity: 'even' },
                    'E5':    { m: 0, d: 31, parity: 'odd' },
                    'E6':    { m: 10, d: 30, parity: 'even' },
                    'E7':    { m: 8, d: 30, parity: 'odd' },
                    'E8':    { m: 6, d: 31, parity: 'even' },
                    'E9':    { m: 4, d: 31, parity: 'odd' }
                }[rank];

                if (!scodConfig) return;

                // Handle year shift for Feb SCOD (Accounting Date is in previous year)
                let scodYear = year;
                let accYear = year;
                if (rank === 'O6') accYear = year - 1;

                scodDate = new Date(scodYear, scodConfig.m, scodConfig.d, 23, 59, 59);
                
                // Enlisted Biennial Logic for DSG
                if (rank.startsWith('E') && status === 'DSG') {
                    const isEven = scodYear % 2 === 0;
                    const expected = scodConfig.parity;
                    const match = (expected === 'even' && isEven) || (expected === 'odd' && !isEven);
                    
                    biennialEl.classList.remove('hidden');
                    if (!match) {
                        warningEl.classList.remove('hidden');
                        document.getElementById('scod-parity-note').innerText = expected;
                    } else {
                        warningEl.classList.add('hidden');
                    }
                } else {
                    biennialEl.classList.add('hidden');
                    warningEl.classList.add('hidden');
                }

                // Calc Accounting Date (Literal -120 days)
                accountingDate = new Date(scodDate.getTime() - (120 * 86400000));
            }

            const mos = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            document.getElementById('scod-display').innerText = `${String(scodDate.getDate()).padStart(2, '0')} ${mos[scodDate.getMonth()]} ${scodDate.getFullYear()}`;
            document.getElementById('accounting-display').innerText = `${String(accountingDate.getDate()).padStart(2, '0')} ${mos[accountingDate.getMonth()]} ${accountingDate.getFullYear()}`;
            
            const diff = Math.ceil((scodDate - new Date()) / 86400000);
            document.getElementById('scod-countdown').innerText = diff > 0 ? `${diff.toLocaleString()} Days until SCOD` : (diff === 0 ? "SCOD is Today" : `${Math.abs(diff).toLocaleString()} Days past SCOD`);
        }

        // --- SHARED UI ---
        function addPeriod(data = null) {
            const period = data || { id: Date.now(), desc: '', start: '', end: '', manualDays: '' };
            if (!data) periods.push(period);
            const div = document.createElement('div'); div.id = `period-${period.id}`;
            div.className = "grid grid-cols-1 md:grid-cols-12 gap-3 p-4 bg-white/50 rounded-2xl border border-slate-100 items-end relative period-row mb-4 shadow-sm";
            div.innerHTML = `<div class="md:col-span-3"><input type="text" value="${period.desc}" oninput="updatePeriod(${period.id}, 'desc', this.value)" placeholder="Description" class="w-full px-2 py-2 text-xs rounded-lg border border-slate-200 font-bold outline-none"></div><div class="md:col-span-3"><input type="date" value="${period.start}" oninput="updatePeriod(${period.id}, 'start', this.value)" class="w-full px-1 py-2 text-xs rounded-lg border border-slate-200 font-bold outline-none"></div><div class="md:col-span-3"><input type="date" value="${period.end}" oninput="updatePeriod(${period.id}, 'end', this.value)" class="w-full px-1 py-2 text-xs rounded-lg border border-slate-200 font-bold outline-none"></div><div class="md:col-span-3 flex items-center justify-end gap-3 no-print"><div class="text-center mr-1 flex-grow"><input type="number" value="${period.manualDays}" oninput="updatePeriod(${period.id}, 'manualDays', this.value)" placeholder="Override" class="w-full bg-white border border-slate-200 text-center text-xs font-bold text-blue-600 rounded-md py-1"></div><div class="flex flex-col items-center gap-1"><button onclick="removePeriod(${period.id})" class="p-1 text-slate-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button><div class="row-day-count ca-gold-bg text-white text-[10px] font-black px-2 py-1 flex items-center justify-center rounded-lg shadow-sm min-w-[32px]">0</div></div></div><div id="row-badge-${period.id}" class="absolute -top-2 -left-2 hidden uppercase"><span class="pro-rated-badge bg-blue-600 text-white text-[8px] font-black px-2 py-0.5 rounded-full shadow-sm uppercase">Cutoff Applied</span></div>`;
            document.getElementById('periods-container').appendChild(div); lucide.createIcons(); calculate();
        }
        function removePeriod(id) { if (periods.length > 1) { periods = periods.filter(p => p.id !== id); document.getElementById(`period-${id}`).remove(); calculate(); } }
        function updatePeriod(id, field, value) { const p = periods.find(p => p.id === id); if (p) p[field] = value; calculate(); }

        function addPeriod1825(data = null) {
            const period = data || { id: Date.now(), desc: '', start: '', end: '', type: 'ADOS-RC' };
            if (!data) periods1825.push(period);
            const div = document.createElement('div'); div.id = `period1825-${period.id}`;
            div.className = "grid grid-cols-1 md:grid-cols-12 gap-3 p-4 bg-white/90 backdrop-blur rounded-3xl border border-slate-100 items-end shadow-sm mb-4";
            div.innerHTML = `<div class="md:col-span-2"><select onchange="updatePeriod1825(${period.id}, 'type', this.value)" class="w-full px-2 py-2 text-[11px] rounded-lg border border-slate-200 font-bold bg-slate-50 uppercase"><option value="ADOS-RC">ADOS-RC</option><option value="ADOS-AC">ADOS-AC</option><option value="MPA">MPA</option><option value="AGR">AGR (E)</option><option value="ADT">ADT (E)</option><option value="AT">AT (E)</option><option value="School">Sch (E)</option></select></div><div class="md:col-span-2"><input type="text" value="${period.desc}" placeholder="Description" oninput="updatePeriod1825(${period.id}, 'desc', this.value)" class="w-full px-2 py-2 text-[11px] rounded-lg border border-slate-200 font-bold outline-none"></div><div class="md:col-span-3"><input type="date" value="${period.start}" oninput="updatePeriod1825(${period.id}, 'start', this.value)" class="w-full px-1 py-2 text-[11px] rounded-lg border border-slate-200 font-bold outline-none"></div><div class="md:col-span-3"><input type="date" value="${period.end}" oninput="updatePeriod1825(${period.id}, 'end', this.value)" class="w-full px-1 py-2 text-[11px] rounded-lg border border-slate-200 font-bold outline-none"></div><div class="md:col-span-2 flex flex-col items-end gap-2 no-print"><button onclick="removePeriod1825(${period.id})" class="p-2 text-slate-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button><div class="row-day-count ca-gold-bg text-white text-[10px] font-black px-2 py-1 flex items-center justify-center rounded-lg shadow-sm min-w-[32px]">0</div></div>`;
            document.getElementById('periods-1825-container').appendChild(div); lucide.createIcons(); calculate1825();
        }
        function removePeriod1825(id) { if (periods1825.length > 1) { periods1825 = periods1825.filter(p => p.id !== id); document.getElementById(`period1825-${id}`).remove(); calculate1825(); } }
        function updatePeriod1825(id, field, value) { const p = periods1825.find(p => p.id === id); if (p) p[field] = value; calculate1825(); }

        function parseText() {
            const text = document.getElementById('pcars-input').value; if (!text) return;
            const dateRegex = /(\d{1,2}[-\s][A-Z]{3}[-\s]\d{4})|(\d{4}[\/-]\d{2}[\/-]\d{2})/gi;
            const monthMap = { JAN:'01', FEB:'02', MAR:'03', APR:'04', MAY:'05', JUN:'06', JUL:'07', AUG:'08', SEP:'09', OCT:'10', NOV:'11', DEC:'12' };
            const normalize = (d) => { const p = d.trim().replace(/[-\/]/g, ' ').split(/\s+/); return p.length === 3 ? (p[1].length === 3 ? `${p[2]}-${monthMap[p[1].toUpperCase()]}-${p[0].padStart(2, '0')}` : `${p[0]}-${p[1].padStart(2, '0')}-${p[2].padStart(2, '0')}`) : null; };
            const lines = text.split('\n'); const found = [];
            lines.forEach(l => { const m = l.match(dateRegex); if (m && m.length === 2 && !l.toUpperCase().includes(' Z ')) { const s = normalize(m[0]), e = normalize(m[1]), pts = parseInt(l.replace(m[0],'').replace(m[1],'').trim().split(/\s+/)[0]); if (s && e && pts > 0) found.push({ id: Date.now() + Math.random(), desc: `Imported`, start: s, end: e, manualDays: pts }); } });
            if (found.length > 0) { document.getElementById('periods-container').innerHTML = ''; periods = found; periods.forEach(p => addPeriod(p)); }
            calculate();
        }

        window.onload = () => {
            document.getElementById('ref-date-1825').value = new Date().toISOString().split('T')[0];
            document.getElementById('scod-year').value = new Date().getFullYear();
            addPeriod(periods[0]); addPeriod1825(periods1825[0]);
            lucide.createIcons(); showView('home');
        };
    </script>
</body>
</html>
